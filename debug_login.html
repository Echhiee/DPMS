<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Login</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    .container { background: white; padding: 20px; border-radius: 8px; max-width: 800px; margin: 0 auto; }
    .test { margin: 15px 0; padding: 15px; border-radius: 5px; }
    .pass { background: #e8f5e9; color: #2e7d32; }
    .fail { background: #ffebee; color: #c62828; }
    button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-test { background: #2196F3; color: white; }
    code { background: #f5f5f5; padding: 10px; display: block; margin: 10px 0; overflow-x: auto; }
  </style>
</head>
<body>
<div class="container">
  <h1>üß™ Login Form Debug</h1>

  <div class="test">
    <h3>Test 1: Direct API Test</h3>
    <button class="btn-test" onclick="testAPI()">Test auth_login.php</button>
    <code id="apiResult"></code>
  </div>

  <div class="test">
    <h3>Test 2: Check JavaScript Loading</h3>
    <button class="btn-test" onclick="checkJS()">Check JS Functions</button>
    <code id="jsResult"></code>
  </div>

  <div class="test">
    <h3>Test 3: Test Form Submission</h3>
    <input type="email" id="testEmail" placeholder="admin@care.com" value="admin@care.com" style="padding: 8px; margin: 5px;">
    <input type="password" id="testPassword" placeholder="123456" value="123456" style="padding: 8px; margin: 5px;">
    <button class="btn-test" onclick="testLogin()">Test Login Submit</button>
    <code id="loginResult"></code>
  </div>

  <div class="test">
    <h3>Browser Console</h3>
    <p>‚ö†Ô∏è Open your browser's Developer Tools (F12) and check the Console tab for errors.</p>
    <p>Then try the login again and tell me what errors appear.</p>
  </div>
</div>

<script>
async function testAPI() {
  const result = document.getElementById('apiResult');
  result.textContent = 'Testing...';
  try {
    const res = await fetch('api/auth_login.php', {
      method: 'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: 'admin@care.com', password: '123456' })
    });
    
    const text = await res.text();
    result.textContent = `Status: ${res.status}\n\n${text}`;
  } catch (e) {
    result.textContent = `ERROR: ${e.message}`;
  }
}

function checkJS() {
  const result = document.getElementById('jsResult');
  result.textContent = 'Checking...';
  
  try {
    // Check if home.js loaded
    const checks = [];
    checks.push('‚úì Fetch available: ' + typeof fetch);
    checks.push('‚úì Session check possible');
    checks.push('‚úì Page loaded: ' + document.readyState);
    
    result.textContent = checks.join('\n');
  } catch (e) {
    result.textContent = `ERROR: ${e.message}`;
  }
}

async function testLogin() {
  const result = document.getElementById('loginResult');
  const email = document.getElementById('testEmail').value;
  const password = document.getElementById('testPassword').value;
  
  result.textContent = 'Submitting...';
  
  try {
    const res = await fetch('api/auth_login.php', {
      method: 'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    const json = await res.json();
    
    if (res.ok && json?.ok) {
      result.textContent = `SUCCESS!\n\n${JSON.stringify(json, null, 2)}`;
    } else {
      result.textContent = `FAILED:\n\n${JSON.stringify(json, null, 2)}`;
    }
  } catch (e) {
    result.textContent = `ERROR: ${e.message}`;
  }
}
</script>
</body>
</html>
